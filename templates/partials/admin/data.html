<!-- Data -->
<section class="rounded-lg border bg-surface p-5">
  <div class="flex flex-col gap-4">
    <div>
      <h2 class="text-lg font-semibold text-text">Data</h2>
      <p class="mt-1 text-sm text-text-secondary">
        Export all book data as JSON, restore from a previous backup, or reset
        to start fresh.
      </p>
    </div>

    <div class="flex flex-col gap-3 sm:flex-row sm:flex-wrap">
      <a
        href="/api/v1/backup"
        download
        class="inline-flex w-full items-center justify-center gap-2 rounded-md bg-accent px-4 py-2 text-sm font-semibold text-accent-text transition hover:bg-accent-hover sm:w-auto sm:min-w-44"
      >
        {{ icons::arrow_down_tray("h-4 w-4") }} New Backup
      </a>
      <button
        type="button"
        class="inline-flex w-full items-center justify-center gap-2 rounded-md border px-4 py-2 text-sm font-medium text-accent transition hover:text-text hover:bg-surface-alt sm:w-auto sm:min-w-44"
        onclick="document.getElementById('restore-file-input').click()"
      >
        {{ icons::arrow_up_tray("h-4 w-4") }} Restore
      </button>
      <button
        type="button"
        data-signals:_recomputing="false"
        data-on:click="$_recomputing = true; @post('/api/v1/stats/recompute')"
        data-on:datastar-fetch="if (!$_recomputing) return;
        if (evt.detail.type === 'finished') { $_recomputing = false; document.getElementById('backup-status').textContent = 'Stats recomputed successfully.'; document.getElementById('backup-status').classList.remove('hidden') }
        else if (evt.detail.type === 'error') { $_recomputing = false; document.getElementById('backup-error').textContent = 'Stats recompute failed.'; document.getElementById('backup-error').classList.remove('hidden') }"
        data-attr:disabled="$_recomputing"
        class="inline-flex w-full items-center justify-center gap-2 rounded-md border px-4 py-2 text-sm font-medium text-accent transition hover:text-text hover:bg-surface-alt disabled:opacity-50 disabled:cursor-not-allowed sm:w-auto sm:min-w-44"
      >
        <span data-show="!$_recomputing">{{ icons::refresh("h-4 w-4") }}</span>
        <span data-show="$_recomputing" style="display:none"
          >{{ icons::spinner("h-4 w-4") }}</span
        >
        Recompute Stats
      </button>
      <button
        type="button"
        class="inline-flex w-full items-center justify-center gap-2 rounded-md border px-4 py-2 text-sm font-medium text-accent transition hover:text-text hover:bg-surface-alt sm:w-auto sm:min-w-44"
        onclick="resetDatabase()"
      >
        {{ icons::delete("h-4 w-4") }} Reset
      </button>
    </div>

    <input
      type="file"
      id="restore-file-input"
      accept=".json"
      class="hidden"
      onchange="restoreFromFile(this)"
    />

    <div
      id="backup-status"
      class="hidden rounded-md border border-success-border bg-success-bg p-4 text-sm text-success-text"
    ></div>
    <div
      id="backup-error"
      class="hidden rounded-md bg-error-bg border border-error-border p-3 text-sm text-error-text"
      role="alert"
    ></div>
  </div>
</section>
