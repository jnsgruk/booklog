<!-- Passkeys -->
<section
  data-signals:_show-passkey-form="false"
  class="rounded-lg border bg-surface p-5"
>
  <div class="flex flex-col gap-4">
    <div>
      <h2 class="text-lg font-semibold text-text">Passkeys</h2>
      <p class="mt-1 text-sm text-text-secondary">
        Passkeys enable secure sign-in without a password.
      </p>
    </div>

    <div class="flex flex-col gap-2">
      {% for passkey in passkeys %}
        <div
          class="flex items-center justify-between gap-4 rounded-md bg-surface-alt px-4 py-3"
        >
          <div class="flex items-center gap-3 min-w-0">
            {{ icons::key("h-4 w-4 text-accent shrink-0") }}
            <div class="min-w-0">
              <span class="block text-sm font-semibold text-text"
                >{{ passkey.name }}</span
              >
              <span class="block text-xs text-text-muted">
                Added {{ passkey.created_at }} Â·
                {% if let Some(last_used) = passkey.last_used_at %}
                  Last used {{ last_used }}
                {% else %}
                  Never used
                {% endif %}
              </span>
            </div>
          </div>
          {% if passkeys.len() > 1 %}
            <button
              type="button"
              class="shrink-0 inline-flex items-center justify-center rounded-md border text-accent transition hover:text-text hover:bg-surface-alt h-8 w-8 sm:h-auto sm:w-auto sm:gap-2 sm:px-4 sm:py-2 sm:text-sm sm:font-medium"
              onclick="deletePasskey({{ passkey.id }}, '{{ passkey.name }}')"
              aria-label="Delete passkey"
            >
              {{ icons::delete("h-4 w-4") }}
              <span class="hidden sm:inline">Delete</span>
            </button>
          {% endif %}
        </div>
      {% endfor %}
    </div>

    {% if passkeys.len() <= 1 %}
      <p class="text-xs text-text-muted">
        Add another passkey before removing the only one.
      </p>
    {% endif %}

    <!-- Add passkey form -->
    <div
      id="add-passkey-form"
      class="rounded-md border bg-surface-alt p-4"
      data-show="$_showPasskeyForm"
      style="display: none"
    >
      <div
        id="add-passkey-error"
        class="mb-3 hidden rounded-md bg-error-bg border border-error-border p-2 text-sm text-error-text"
        role="alert"
      ></div>
      <div class="flex flex-col gap-3 sm:flex-row sm:items-end">
        <label class="flex flex-col gap-1 text-sm sm:flex-1">
          <span class="text-text">Passkey Name</span>
          <input
            type="text"
            id="passkey-name"
            required
            aria-required="true"
            class="input-field"
            placeholder="e.g. MacBook Touch ID, iPhone"
          />
        </label>
        <div class="flex gap-3">
          <button
            id="add-passkey-btn"
            type="button"
            onclick="registerPasskey()"
            class="flex-1 inline-flex items-center justify-center gap-2 rounded-md bg-accent px-4 py-2 text-sm font-semibold text-accent-text transition hover:bg-accent-hover disabled:opacity-50 disabled:cursor-not-allowed sm:flex-initial"
          >
            {{ icons::key("h-4 w-4") }} Register
          </button>
          <button
            type="button"
            data-on:click="$_showPasskeyForm = false; document.getElementById('add-passkey-error').classList.add('hidden'); document.getElementById('passkey-name').value = ''"
            class="flex-1 inline-flex items-center justify-center gap-2 rounded-md border px-4 py-2 text-sm font-medium text-text transition hover:bg-surface-alt sm:flex-initial"
          >
            {{ icons::x_mark("h-4 w-4") }} Cancel
          </button>
        </div>
      </div>
      <div
        id="add-passkey-loading"
        class="mt-3 hidden flex items-center gap-3 text-sm text-accent"
      >
        {{ icons::spinner("h-5 w-5") }} Follow the prompts from the browser or
        device...
      </div>
    </div>

    <div>
      <button
        type="button"
        data-show="!$_showPasskeyForm"
        data-on:click="$_showPasskeyForm = true; setTimeout(() => document.getElementById('passkey-name').focus(), 50)"
        class="inline-flex w-full items-center justify-center gap-2 rounded-md bg-accent px-4 py-2 text-sm font-semibold text-accent-text transition hover:bg-accent-hover sm:w-auto sm:min-w-44"
      >
        {{ icons::key("h-4 w-4") }} New Passkey
      </button>
    </div>
  </div>
</section>
