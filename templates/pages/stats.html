{% extends "base.html" %}
{% import "partials/icons.html" as icons %}
{% block title %}Booklog · Stats{% endblock %}
{% block og_title %}Stats — Booklog{% endblock %}
{% block og_description %}
  Aggregated library data across books, authors, and genres.
{% endblock %}
{% block head %}
  <meta property="og:image" content="{{ base_url }}/static/og-image.png" />
{% endblock %}
{% block content %}
  <header class="flex flex-col gap-2">
    <div class="flex items-start justify-between gap-4">
      <h1 class="text-3xl font-semibold">Stats</h1>
      {% if !cache_age.is_empty() %}
        <span class="shrink-0 text-xs text-text-muted pt-2"
          >Updated {{ cache_age }}</span
        >
      {% endif %}
    </div>
    <p class="max-w-2xl text-sm text-text-secondary">
      Aggregated library data across books, authors, and genres.
    </p>
  </header>

  {% if !year_tabs.is_empty() %}
    <div data-signals:_stats-year="'{{ active_year }}'">
      {# Desktop tabs #}
      <nav class="hidden md:flex gap-1.5" role="tablist">
        {% for tab in year_tabs %}
          <button
            type="button"
            role="tab"
            class="tab"
            data-class:tab-active="$_statsYear === '{{ tab.key }}'"
            data-on:click="$_statsYear = '{{ tab.key }}';
              history.pushState(null, '', '/stats?year={{ tab.key }}');
              @get('/stats?year={{ tab.key }}', {responseOverrides: {selector: '#stats-content', mode: 'replace'}})"
          >
            {{ tab.label }}
          </button>
        {% endfor %}
      </nav>
      {# Mobile tab selector #}
      <div class="md:hidden" data-signals:_stats-tabs-open="false">
        <button
          type="button"
          class="flex w-full items-center justify-between rounded-md border border-accent p-3 text-sm font-medium text-accent"
          data-on:click="$_statsTabsOpen = !$_statsTabsOpen"
        >
          <span>
            {% for tab in year_tabs %}
              <span
                data-show="$_statsYear === '{{ tab.key }}'"
                {% if tab.key != active_year %}style="display:none"{% endif %}
                >{{ tab.label }}</span
              >
            {% endfor %}
          </span>
          <span data-show="!$_statsTabsOpen"
            >{{ icons::chevron_down("h-5 w-5") }}</span
          >
          <span data-show="$_statsTabsOpen" style="display:none"
            >{{ icons::chevron_up("h-5 w-5") }}</span
          >
        </button>
        <div
          class="mt-1 flex flex-col rounded-md border overflow-hidden"
          data-show="$_statsTabsOpen"
          style="display:none"
        >
          {% for tab in year_tabs %}
            <button
              type="button"
              class="tab-mobile"
              data-class:tab-mobile-active="$_statsYear === '{{ tab.key }}'"
              data-on:click="$_statsYear = '{{ tab.key }}'; $_statsTabsOpen = false;
                history.pushState(null, '', '/stats?year={{ tab.key }}');
                @get('/stats?year={{ tab.key }}', {responseOverrides: {selector: '#stats-content', mode: 'replace'}})"
            >
              {{ tab.label }}
            </button>
          {% endfor %}
        </div>
      </div>
    </div>
  {% endif %}

  <div id="stats-content" class="flex flex-col gap-8">{{ content|safe }}</div>
{% endblock %}
